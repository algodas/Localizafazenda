<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Localizar fazendas: ( Com Bioma vinculado a cacau, que possua malhas de √°gua a menos de 3KM e com rodovias a menos de 6KM)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f2f2f2;
    }
    header {
      background-color: #4CAF50;
      color: white;
      padding: 16px;
      font-size: 20px;
    }
    .container {
      padding: 20px;
      max-width: 960px;
      margin: auto;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: 2px solid #ddd;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    h2 {
      color: #333;
    }
    input[type="file"], button {
      display: block;
      margin: 10px 0;
      padding: 10px;
      font-size: 14px;
    }
    ul {
      line-height: 1.6;
      list-style: none;
      padding-left: 0;
    }
    li a {
      text-decoration: none;
      color: #1a73e8;
    }
    li a:hover {
      text-decoration: underline;
    }
    .map-link {
      margin-top: 20px;
      font-weight: bold;
    }
    .descricao {
      background-color: #fff;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <header>
    üìç Localizar fazendas: (Com Bioma vinculado a cacau, que possua malhas de √°gua a menos de 3KM e com rodovias a menos de 6KM)
  </header>

  <div class="container">

    <div class="descricao">
      <p><strong>Para facilitar o entendimento, o processo foi dividido em duas fases:</strong></p>
    </div>

    <div class="descricao">
      <h2>üîç Fase 1: Identifica√ß√£o de √Åreas com Potencial para Cacau</h2>
      <p>Voc√™ informa a <strong>latitude</strong>, <strong>longitude</strong> e o <strong>raio (em km)</strong> da regi√£o de interesse. O sistema ir√° identificar planta√ß√µes de cacau que estejam a <strong>menos de 3 km de fontes de √°gua</strong>, indicando √°reas com potencial para cultivo sustent√°vel.</p>
      <p>O resultado desta fase ser√° um <strong>arquivo CSV</strong> contendo os registros geogr√°ficos identificados. Esse arquivo servir√° como <strong>entrada para a Fase 2</strong>, onde ser√° avaliada a proximidade dessas planta√ß√µes com rodovias.</p>
    </div>

    <iframe src="https://bubbly-tractor-348100.projects.earthengine.app/view/localizafazenda" allowfullscreen></iframe>

    <div class="descricao">
      <h2>üõ£Ô∏è Fase 2: Verifica√ß√£o de Acessibilidade Rodovi√°ria</h2>
      <p>Nesta fase, voc√™ realiza o <strong>upload do CSV gerado anteriormente</strong>. O sistema ir√° verificar quais das √°reas mapeadas est√£o a <strong>menos de 6 km de uma rodovia</strong>, o que facilita o escoamento da produ√ß√£o.</p>
      <p>Ao final, ser√£o gerados <strong>links para mapas referenciais</strong>, destacando as √°reas com condi√ß√µes ideais para o cultivo de cacau <strong>e</strong> com <strong>boa acessibilidade log√≠stica</strong>.</p>
    </div>

    <h2>üì• Regi√µes identificadas com cultivo de Cacau e pr√≥ximas de √Ågua e Rodovias</h2>
    <input type="file" id="fileInput" accept=".csv">
    <button onclick="processarCSV()">üì§ Processar Arquivo</button>
    <div id="output"></div>
  </div>

  <script>
    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const headers = lines[0].split(",");
      return lines.slice(1).map(line => {
        const values = line.split(",");
        return Object.fromEntries(headers.map((h, i) => [h.trim(), values[i]?.trim() || ""]));
      });
    }

    async function processarCSV() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("Selecione um arquivo CSV primeiro.");
      const text = await file.text();
      const dados = parseCSV(text);
      const cacauRodovia = dados.filter(d => d.tipo_origem === 'cacau_agua');

      const coordsLinks = [];
      let ulHTML = '<ul>';
      for (const item of cacauRodovia) {
        const lat = parseFloat(item.latitude).toFixed(6);
        const lon = parseFloat(item.longitude).toFixed(6);
        const link = `https://www.google.com/maps?q=${lat},${lon}`;
        coordsLinks.push(`${lat},${lon}`);
        ulHTML += `<li><a href="${link}" target="_blank">${lat}, ${lon}</a></li>`;
      }
      ulHTML += '</ul>';

      let linkMapaTodos = '';
      if (coordsLinks.length > 1) {
        const destino = coordsLinks[coordsLinks.length - 1];
        const waypoints = coordsLinks.slice(0, -1).join("|");
        const allMap = `https://www.google.com/maps/dir/?api=1&destination=${destino}&waypoints=${waypoints}`;
        linkMapaTodos = `<div class="map-link">üó∫Ô∏è <a href="${allMap}" target="_blank">Ver todos os pontos no mapa</a></div>`;
      }

      document.getElementById("output").innerHTML = ulHTML + linkMapaTodos;
    }
  </script>
</body>
</html>
